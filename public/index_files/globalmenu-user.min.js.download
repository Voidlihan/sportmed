var notypagenum=1,notypagenum2=1,$allNoticeBlocks=$('.bmc-main-menu .bmc-site-notices .bmc-notice'),$searchReadedNotices=$('.bmc-main-menu .bmc-site-notices .bmc-searchBlock-readed-notices'),$searchReadedNoticesBtn=$('.bmc-main-menu .bmc-site-notices .bmc-search-readedNotices'),$searchUnreadedNotices=$('.bmc-main-menu .bmc-site-notices .bmc-searchBlock-unreaded-notices'),$searchUnreadedNoticesBtn=$('.bmc-main-menu .bmc-site-notices .bmc-search-unreadedNotices');getNoticesIncoming();$('.bmc-main-menu .bmc-notice-mainBtn, .bmc-main-menu .bmc-site-notices .bmc-get-unreaded-notices').on('click',function(){getNoticesUnreaded();});$('.bmc-main-menu .bmc-site-notices .bmc-unreaded-notices').on('click','.bmc-notice-markReaded-btn',function(){var $elem=$(this),$parentNoticeItem=$elem.parents('.bmc-notice-item'),noticePkid=$elem.data('notice-pkid');if(!$elem.hasClass('process')){$elem.addClass('process');$elem.find('i').removeClass('fa-times').addClass('fa-spinner');ioCallEntity({entity:'com.notice.model.notices.setReaded',resultType:'json',params:{pkid:noticePkid,},success:function(data){var obj;try{obj=$.parseJSON(data);}catch(ex){obj=null;}
if(obj!=null&&typeof(obj.res)!='undefined'&&obj.res!=null&&obj.res.error_code=='1'){$parentNoticeItem.fadeOut('slow',function(){setTimeout(function(){$parentNoticeItem.remove();var count=$('.bmc-main-menu .bmc-unreaded-notices .bmc-notice-item').length;if(count==0){getNoticesUnreaded($searchUnreadedNotices.find('input').val());}},350);});}else{var n=noty({text:'Что-то пошло не так :( Не удалось отметить уведомление как "прочитанное". Попробуйте еще раз.'+(obj!=null&&obj.res.error_str!=''?' Полный текст ошибки: '+obj.res.error_str:''),type:'warning',layout:'bottomRight',timeout:2000,});$elem.removeClass('process');$elem.find('i').removeClass('fa-spinner').addClass('fa-times');}}});}});$('.bmc-main-menu .bmc-site-notices .bmc-mark-allNotices-readed').on('click',function(){var $elem=$(this);if(!$elem.hasClass('process')){$elem.addClass('process');$elem.find('i').removeClass('fa-eraser').addClass('fa-spinner');ioCallEntity({entity:'com.notice.model.notices.setReadedAll',resultType:'json',params:{},success:function(data){var obj;try{obj=$.parseJSON(data);}catch(ex){obj=null;}
if(obj!=null&&typeof(obj.res)!='undefined'&&obj.res!=null&&obj.res.error_code=='1'){$('.bmc-main-menu .bmc-unreaded-notices .bmc-notice-item').fadeOut('slow',function(){setTimeout(function(){hideAllNoticeBlocks();$('.bmc-main-menu .bmc-site-notices .bmc-no-unreaded-notices').css('display','block');$elem.removeClass('process');$elem.find('i').removeClass('fa-spinner').addClass('fa-eraser');},1000);});}else{var n=noty({text:'Что-то пошло не так :( Не удалось отметить все уведомления прочитанными. Попробуйте еще раз.'+(obj!=null&&obj.res.error_str!=''?' Полный текст ошибки: '+obj.res.error_str:''),type:'warning',layout:'bottomRight',timeout:2000,});$elem.removeClass('process');$elem.find('i').removeClass('fa-spinner').addClass('fa-eraser');}}});}});$('.bmc-main-menu .bmc-unreaded-notices .bmc-get-moreUnreaded-notices').on('click',function(){$elem=$(this);$elem.html('<i class="fa fa-spinner bmc-icon-xlarge"></i>');getNoticesUnreadedMore($searchUnreadedNotices.find('input').val());});$searchUnreadedNoticesBtn.on('click',function(){var $elem=$(this);if($searchUnreadedNotices.is(':hidden')){$searchUnreadedNotices.slideDown('fast',function(){$searchUnreadedNotices.find('input').val('').focus();});}else{if(!$elem.find('i').hasClass('fa-spinner')){$searchUnreadedNotices.slideUp('fast',function(){$searchUnreadedNotices.find('input').val('');if($elem.find('i').hasClass('fa-reorder')){getNoticesUnreaded('');}});}}});$searchUnreadedNotices.find('input').on('keyup',function(e){var $elem=$(this);if(e.keyCode===13){notypagenum=0;$searchUnreadedNoticesBtn.find('i').removeClass('fa-search').addClass('fa-spinner');$('.bmc-main-menu .bmc-unreaded-notices .bmc-noticesList').html('');getNoticesUnreadedMore($elem.val());}});$('.bmc-main-menu .bmc-site-notices .bmc-get-readed-notices').on('click',function(){getNoticesReaded();});$('.bmc-main-menu .bmc-readed-notices .bmc-get-moreReaded-notices').on('click',function(){$elem=$(this);$elem.html('<i class="fa fa-spinner bmc-icon-xlarge"></i>');getNoticesReadedMore($searchReadedNotices.find('input').val());});$('.bmc-main-menu .bmc-site-notices .bmc-readed-notices').on('click','.bmc-notice-delete-btn',function(){var $elem=$(this),$parentNoticeItem=$elem.parents('.bmc-notice-item'),noticePkid=$elem.data('notice-pkid');if(!$elem.hasClass('process')){$elem.addClass('process');$elem.find('i').removeClass('fa-times').addClass('fa-spinner');ioCallEntity({entity:'com.notice.model.notices.delete',resultType:'json',params:{pkid:noticePkid,},success:function(data){var obj;try{obj=$.parseJSON(data);}catch(ex){obj=null;}
if(obj!=null&&typeof(obj.res)!='undefined'&&obj.res!=null&&obj.res.error_code=='1'){$parentNoticeItem.fadeOut('slow',function(){setTimeout(function(){$parentNoticeItem.remove();var count=$('.bmc-main-menu .bmc-readed-notices .bmc-notice-item').length;if(count==0){getNoticesReaded($searchReadedNotices.find('input').val());}},350);});}else{var n=noty({text:'Что-то пошло не так :( Не удалось отметить уведомление как "прочитанное". Попробуйте еще раз.'+(obj!=null&&obj.res.error_str!=''?' Полный текст ошибки: '+obj.res.error_str:''),type:'warning',layout:'bottomRight',timeout:2000,});$elem.removeClass('process');$elem.find('i').removeClass('fa-spinner').addClass('fa-times');}}});}});$('.bmc-main-menu .bmc-site-notices .bmc-delete-allReaded-notices').on('click',function(){$elem=$(this);if(!$elem.hasClass('process')){if(confirm('Вы уверены?')){$elem.addClass('process');$elem.find('span').removeClass('fa-eraser').addClass('fa-spinner');ioCallEntity({entity:'com.notice.model.notices.deleteAll',resultType:'json',params:{},success:function(data){var obj;try{obj=$.parseJSON(data);}catch(ex){obj=null;}
if(obj!=null&&typeof(obj.res)!='undefined'&&obj.res!=null&&obj.res.error_code=='1'){$('.bmc-main-menu .bmc-readed-notices .bmc-notice-item').fadeOut('slow',function(){setTimeout(function(){hideAllNoticeBlocks();$('.bmc-main-menu .bmc-site-notices .bmc-no-readed-notices').css('display','block');$elem.removeClass('process');$elem.find('i').removeClass('fa-spinner').addClass('fa-eraser');},1000);});}else{var n=noty({text:'Что-то пошло не так :( Не удалось удалить все уведомления. Попробуйте еще раз.'+(obj!=null&&obj.res.error_str!=''?' Полный текст ошибки: '+obj.res.error_str:''),type:'warning',layout:'bottomRight',timeout:2000,});$elem.removeClass('process');$elem.find('span').removeClass('fa-spinner').addClass('fa-eraser');}}});}}});$searchReadedNoticesBtn.on('click',function(){var $elem=$(this);if($searchReadedNotices.is(':hidden')){$searchReadedNotices.slideDown('fast',function(){$searchReadedNotices.find('input').val('').focus();});}else{if(!$elem.find('i').hasClass('fa-spinner')){$searchReadedNotices.slideUp('fast',function(){$searchReadedNotices.find('input').val('');if($elem.find('i').hasClass('fa-reorder')){getNoticesReaded();}});}}});$searchReadedNotices.find('input').on('keyup',function(e){var $elem=$(this);if(e.keyCode===13){notypagenum2=0;$searchReadedNoticesBtn.find('i').removeClass('fa-search').addClass('fa-spinner');$('.bmc-main-menu .bmc-readed-notices .bmc-noticesList').html('');getNoticesReadedMore($elem.val());}});$('.bmc-main-menu .bmc-site-notices .bmc-get-notice-settings').on('click',function(){ioCallEntity({entity:'com.notice.model.notices.getUnreadedCount',resultType:'json',params:{},success:function(data){var obj;try{obj=$.parseJSON(data);}catch(ex){obj=null;}
if(obj!=null&&typeof(obj.res)!='undefined'&&obj.res!=null&&obj.res.error_code=='1'){var notices_count=obj.res.count;if(notices_count>0){$('.bmc-main-menu .bmc-options-list .bmc-notices-count').addClass('animated infinite fadeIn').html(notices_count);}else{$('.bmc-main-menu .bmc-options-list .bmc-notices-count').removeClass('animated infinite fadeIn').html('');}}else{$('.bmc-main-menu .bmc-options-list .bmc-notices-count').removeClass('animated infinite fadeIn').html('');}}});hideAllNoticeBlocks();$('.bmc-main-menu .bmc-site-notices .bmc-notice-settings').css('display','block');});function getNoticesUnreaded(searchword){notypagenum=1;hideAllNoticeBlocks();$('.bmc-main-menu .bmc-site-notices .bmc-loader-notice').css('display','block');ioCallEntity({entity:'com.notice.model.notices.getUnreaded',resultType:'json',params:{pagenum:1,notycount:3,searchword:searchword||'',},success:function(data){var obj;try{obj=$.parseJSON(data);}catch(ex){obj=null;}
if(obj!=null&&typeof(obj.res)!='undefined'&&obj.res!=null&&obj.res.error_code=='1'){var notices=obj.res.data;var pagescount=obj.res.pagescount;$('.bmc-main-menu .bmc-site-notices .bmc-get-moreUnreaded-notices').css('display',pagescount>1?'':'none');var cnt1=0,cont='';$.each(notices,function(i,val){var noticeType=getNoticeTypeByID(val.type),noticeCat=getNoticeCatByID(val.cat),noticeServiceInfo=getNoticeServiceByApiName(val.service),noticeService=noticeServiceInfo.service,noticeServiceName=noticeServiceInfo.name;var noticeDateof=dateDiff(dateFormat(val.dateShow,'yyyy.mm.dd HH:MM:ss'),Date.now()),noticeDateofStr='';if(noticeDateof.years>0){noticeDateofStr=noticeDateof.years+decl1(noticeDateof.years,[' год назад',' года назад',' лет назад']);}else if(noticeDateof.months>0){noticeDateofStr=noticeDateof.months+decl1(noticeDateof.months,[' месяц назад',' месяца назад',' месяцев назад']);}else if(noticeDateof.days>0){noticeDateofStr=noticeDateof.days+decl1(noticeDateof.days,[' день назад',' дня назад',' дней назад']);}else if(noticeDateof.hours>0){noticeDateofStr=noticeDateof.hours+decl1(noticeDateof.hours,[' час назад',' часа назад',' часов назад']);}else if(noticeDateof.minutes>0){noticeDateofStr=noticeDateof.minutes+decl1(noticeDateof.minutes,[' минута назад',' минуты назад',' минут назад']);}else{noticeDateofStr='только что';}
cont+=''+'<div class="bmc-notice-item'+(noticeType==' default'?'':' '+noticeType)+' notice'+val.pkid+'">'+'<div class="bmc-noticeItem-pic">'+
(val.link!=null?'<a href="'+val.link+'">'+'<!--<img src="/img/cabinet20/img_1.jpg" alt="" />-->'+'<img src="/img/cabinet20/notice/icon-notice-'+noticeCat+'-'+noticeType+'.png" alt="" />'+'</a>':'<span>'+'<!--<img src="/img/cabinet20/img_1.jpg" alt="" />-->'+'<img src="/img/cabinet20/notice/icon-notice-'+noticeCat+'-'+noticeType+'.png" alt="" />'+'</span>')+'</div>'+'<div class="bmc-noticeItem-content">'+'<div class="bmc-noticeItem-btns">'+'<a href="javascript://">'+'<img src="/img/cabinet20/notice/services/'+noticeService+'.png"'+'data-toggle="tooltip" data-placement="top" title="'+noticeServiceName+'" />'+'</a>'+'<a href="javascript://" class="bmc-notice-markReaded-btn"'+'data-notice-pkid="'+val.pkid+'" data-toggle="tooltip" data-placement="top" title="Отметить прочитанным">'+'<i class="fa fa-times"></i>'+'</a>'+'</div>'+'<div class="bmc-noticeItem-userName">'+'<div>'+val.title+'</div>'+'</div>'+'<div class="bmc-noticeItem-text">'+val.message+'</div>'+'<div class="bmc-noticeItem-time">'+'<div>'+noticeDateofStr+' ('+dateFormat(val.dateShow,'dd.mm.yyyy в HH:MM:ss')+')</div>'+'</div>'+'</div>'+'</div>';cnt1++;});$('.bmc-main-menu .bmc-unreaded-notices .bmc-noticesList').html(cont).find('[data-toggle=tooltip]').tooltip();if(cnt1>0){hideAllNoticeBlocks();$('.bmc-main-menu .bmc-site-notices .bmc-unreaded-notices').css('display','block');}else{hideAllNoticeBlocks();$('.bmc-main-menu .bmc-site-notices .bmc-no-unreaded-notices').css('display','block');}}else{hideAllNoticeBlocks();$('.bmc-main-menu .bmc-site-notices .bmc-errorLoad-unreaded-notices').css('display','block');}}});}
function getNoticesUnreadedMore(searchword){notypagenum++;var searchword2=searchword||'';$('.bmc-main-menu .bmc-site-notices .bmc-notices-notfound-block').css('display','none');ioCallEntity({entity:'com.notice.model.notices.getUnreaded',resultType:'json',params:{pagenum:notypagenum,notycount:3,searchword:searchword2,},success:function(data){var obj;try{obj=$.parseJSON(data);}catch(ex){obj=null;}
if(obj!=null&&typeof(obj.res)!='undefined'&&obj.res!=null&&obj.res.error_code=='1'){var notices=obj.res.data;var pagescount=obj.res.pagescount,$allNoticeItems=$('.bmc-main-menu .bmc-unreaded-notices .bmc-noticesList .bmc-notice-item');$('.bmc-main-menu .bmc-unreaded-notices .bmc-get-moreUnreaded-notices').css('display',pagescount>notypagenum?'':'none');var cnt1=0,cont='';$.each(notices,function(i,val){var flag1=true;$allNoticeItems.each(function(j,el){if($(el).hasClass('notice'+val.pkid))flag1=false;});if(flag1){var noticeType=getNoticeTypeByID(val.type),noticeCat=getNoticeCatByID(val.cat),noticeServiceInfo=getNoticeServiceByApiName(val.service),noticeService=noticeServiceInfo.service,noticeServiceName=noticeServiceInfo.name;var noticeDateof=dateDiff(dateFormat(val.dateShow,'yyyy.mm.dd HH:MM:ss'),Date.now()),noticeDateofStr='';if(noticeDateof.years>0){noticeDateofStr=noticeDateof.years+decl1(noticeDateof.years,[' год назад',' года назад',' лет назад']);}else if(noticeDateof.months>0){noticeDateofStr=noticeDateof.months+decl1(noticeDateof.months,[' месяц назад',' месяца назад',' месяцев назад']);}else if(noticeDateof.days>0){noticeDateofStr=noticeDateof.days+decl1(noticeDateof.days,[' день назад',' дня назад',' дней назад']);}else if(noticeDateof.hours>0){noticeDateofStr=noticeDateof.hours+decl1(noticeDateof.hours,[' час назад',' часа назад',' часов назад']);}else if(noticeDateof.minutes>0){noticeDateofStr=noticeDateof.minutes+decl1(noticeDateof.minutes,[' минута назад',' минуты назад',' минут назад']);}else{noticeDateofStr='только что';}
cont+=''+'<div class="bmc-notice-item'+(noticeType=='default'?'':' '+noticeType)+' notice'+val.pkid+'">'+'<div class="bmc-noticeItem-pic">'+
(val.link!=null?'<a href="'+val.link+'">'+'<!--<img src="/img/cabinet20/img_1.jpg" alt="" />-->'+'<img src="/img/cabinet20/notice/icon-notice-'+noticeCat+'-'+noticeType+'.png" alt="" />'+'</a>':'<span>'+'<!--<img src="/img/cabinet20/img_1.jpg" alt="" />-->'+'<img src="/img/cabinet20/notice/icon-notice-'+noticeCat+'-'+noticeType+'.png" alt="" />'+'</span>')+'</div>'+'<div class="bmc-noticeItem-content">'+'<div class="bmc-noticeItem-btns">'+'<a href="javascript://">'+'<img src="/img/cabinet20/notice/services/'+noticeService+'.png"'+'data-toggle="tooltip" data-placement="top" title="'+noticeServiceName+'" />'+'</a>'+'<a href="javascript://" class="bmc-notice-markReaded-btn"'+'data-notice-pkid="'+val.pkid+'" data-toggle="tooltip" data-placement="top" title="Отметить прочитанным">'+'<i class="fa fa-times"></i>'+'</a>'+'</div>'+'<div class="bmc-noticeItem-userName">'+'<div>'+val.title+'</div>'+'</div>'+'<div class="bmc-noticeItem-text">'+val.message+'</div>'+'<div class="bmc-noticeItem-time">'+'<div>'+noticeDateofStr+' ('+dateFormat(val.dateShow,'dd.mm.yyyy HH:MM:ss')+')</div>'+'</div>'+'</div>'+'</div>';cnt1++;}});$('.bmc-main-menu .bmc-unreaded-notices .bmc-noticesList').append(cont).find('[data-toggle=tooltip]').tooltip();}else{}
var cnt2=$('.bmc-main-menu .bmc-unreaded-notices .bmc-noticesList .bmc-notice-item').length;if(cnt2==0){$('.bmc-main-menu .bmc-unreaded-notices .bmc-notices-notfound-block').css('display','block');}else{$('.bmc-main-menu .bmc-unreaded-notices .bmc-notices-notfound-block').css('display','none');}
$('.bmc-main-menu .bmc-unreaded-notices .bmc-get-moreUnreaded-notices').html('Еще');$searchUnreadedNoticesBtn.find('i').removeClass('fa-spinner');if(searchword2!=''){$searchUnreadedNoticesBtn.find('i').addClass('fa-reorder');}else{$searchUnreadedNoticesBtn.find('i').addClass('fa-search');}}});}
function getNoticesReaded(searchword){notypagenum2=1;hideAllNoticeBlocks();$('.bmc-main-menu .bmc-site-notices .bmc-loader-notice').css('display','block');ioCallEntity({entity:'com.notice.model.notices.getReaded',resultType:'json',params:{pagenum:1,notycount:3,searchword:searchword||'',},success:function(data){var obj;try{obj=$.parseJSON(data);}catch(ex){obj=null;}
if(obj!=null&&typeof(obj.res)!='undefined'&&obj.res!=null&&obj.res.error_code=='1'){var notices=obj.res.data;var pagescount=obj.res.pagescount;$('.bmc-main-menu .bmc-site-notices .bmc-get-moreReaded-notices').css('display',pagescount>1?'':'none');var cnt1=0,cont='';$.each(notices,function(i,val){var noticeType=getNoticeTypeByID(val.type),noticeCat=getNoticeCatByID(val.cat),noticeServiceInfo=getNoticeServiceByApiName(val.service),noticeService=noticeServiceInfo.service,noticeServiceName=noticeServiceInfo.name;var noticeDateof=dateDiff(dateFormat(val.dateShow,'yyyy.mm.dd HH:MM:ss'),Date.now()),noticeDateofStr='';if(noticeDateof.years>0){noticeDateofStr=noticeDateof.years+decl1(noticeDateof.years,[' год назад',' года назад',' лет назад']);}else if(noticeDateof.months>0){noticeDateofStr=noticeDateof.months+decl1(noticeDateof.months,[' месяц назад',' месяца назад',' месяцев назад']);}else if(noticeDateof.days>0){noticeDateofStr=noticeDateof.days+decl1(noticeDateof.days,[' день назад',' дня назад',' дней назад']);}else if(noticeDateof.hours>0){noticeDateofStr=noticeDateof.hours+decl1(noticeDateof.hours,[' час назад',' часа назад',' часов назад']);}else if(noticeDateof.minutes>0){noticeDateofStr=noticeDateof.minutes+decl1(noticeDateof.minutes,[' минута назад',' минуты назад',' минут назад']);}else{noticeDateofStr='только что';}
cont+=''+'<div class="bmc-notice-item notice'+val.pkid+'">'+'<div class="bmc-noticeItem-pic">'+
(val.link!=null?'<a href="'+val.link+'">'+'<!--<img src="/img/cabinet20/img_1.jpg" alt="" />-->'+'<img src="/img/cabinet20/notice/icon-notice-'+noticeCat+'-'+noticeType+'.png" alt="" />'+'</a>':'<span>'+'<!--<img src="/img/cabinet20/img_1.jpg" alt="" />-->'+'<img src="/img/cabinet20/notice/icon-notice-'+noticeCat+'-'+noticeType+'.png" alt="" />'+'</span>')+'</div>'+'<div class="bmc-noticeItem-content">'+'<div class="bmc-noticeItem-btns">'+'<a href="javascript://">'+'<img src="/img/cabinet20/notice/services/'+noticeService+'.png"'+'data-toggle="tooltip" data-placement="top" title="'+noticeServiceName+'" />'+'</a>'+'<a href="javascript://" class="bmc-notice-delete-btn"'+'data-notice-pkid="'+val.pkid+'" data-toggle="tooltip" data-placement="top" title="Удалить">'+'<i class="fa fa-times"></i>'+'</a>'+'</div>'+'<div class="bmc-noticeItem-userName">'+'<div>'+val.title+'</div>'+'</div>'+'<div class="bmc-noticeItem-text">'+val.message+'</div>'+'<div class="bmc-noticeItem-time">'+'<div>'+noticeDateofStr+' ('+dateFormat(val.dateShow,'dd.mm.yyyy HH:MM:ss')+')</div>'+'</div>'+'</div>'+'</div>';cnt1++;});$('.bmc-main-menu .bmc-readed-notices .bmc-noticesList').html(cont).find('[data-toggle=tooltip]').tooltip();if(cnt1>0){hideAllNoticeBlocks();$('.bmc-main-menu .bmc-site-notices .bmc-readed-notices').css('display','block');}else{hideAllNoticeBlocks();$('.bmc-main-menu .bmc-site-notices .bmc-no-readed-notices').css('display','block');}}else{hideAllNoticeBlocks();$('.bmc-main-menu .bmc-site-notices .bmc-errorLoad-readed-notices').css('display','block');}}});}
function getNoticesReadedMore(searchword){notypagenum2++;var searchword2=searchword||'';$('.bmc-main-menu .bmc-site-notices .bmc-notices-notfound-block').css('display','none');ioCallEntity({entity:'com.notice.model.notices.getReaded',resultType:'json',params:{pagenum:notypagenum2,notycount:3,searchword:searchword2,},success:function(data){var obj;try{obj=$.parseJSON(data);}catch(ex){obj=null;}
if(obj!=null&&typeof(obj.res)!='undefined'&&obj.res!=null&&obj.res.error_code=='1'){var notices=obj.res.data;var pagescount=obj.res.pagescount,$allNoticeItems=$('.bmc-main-menu .bmc-readed-notices .bmc-noticesList .bmc-notice-item');$('.bmc-main-menu .bmc-readed-notices .bmc-get-moreReaded-notices').css('display',pagescount>notypagenum2?'':'none');var cnt1=0,cont='';$.each(notices,function(i,val){var flag1=true;$allNoticeItems.each(function(j,el){if($(el).hasClass('notice'+val.pkid))flag1=false;});if(flag1){var noticeType=getNoticeTypeByID(val.type),noticeCat=getNoticeCatByID(val.cat),noticeServiceInfo=getNoticeServiceByApiName(val.service),noticeService=noticeServiceInfo.service,noticeServiceName=noticeServiceInfo.name;var noticeDateof=dateDiff(dateFormat(val.dateShow,'yyyy.mm.dd HH:MM:ss'),Date.now()),noticeDateofStr='';if(noticeDateof.years>0){noticeDateofStr=noticeDateof.years+decl1(noticeDateof.years,[' год назад',' года назад',' лет назад']);}else if(noticeDateof.months>0){noticeDateofStr=noticeDateof.months+decl1(noticeDateof.months,[' месяц назад',' месяца назад',' месяцев назад']);}else if(noticeDateof.days>0){noticeDateofStr=noticeDateof.days+decl1(noticeDateof.days,[' день назад',' дня назад',' дней назад']);}else if(noticeDateof.hours>0){noticeDateofStr=noticeDateof.hours+decl1(noticeDateof.hours,[' час назад',' часа назад',' часов назад']);}else if(noticeDateof.minutes>0){noticeDateofStr=noticeDateof.minutes+decl1(noticeDateof.minutes,[' минута назад',' минуты назад',' минут назад']);}else{noticeDateofStr='только что';}
cont+=''+'<div class="bmc-notice-item notice'+val.pkid+'">'+'<div class="bmc-noticeItem-pic">'+
(val.link!=null?'<a href="'+val.link+'">'+'<!--<img src="/img/cabinet20/img_1.jpg" alt="" />-->'+'<img src="/img/cabinet20/notice/icon-notice-'+noticeCat+'-'+noticeType+'.png" alt="" />'+'</a>':'<span>'+'<!--<img src="/img/cabinet20/img_1.jpg" alt="" />-->'+'<img src="/img/cabinet20/notice/icon-notice-'+noticeCat+'-'+noticeType+'.png" alt="" />'+'</span>')+'</div>'+'<div class="bmc-noticeItem-content">'+'<div class="bmc-noticeItem-btns">'+'<a href="javascript://">'+'<img src="/img/cabinet20/notice/services/'+noticeService+'.png"'+'data-toggle="tooltip" data-placement="top" title="'+noticeServiceName+'" />'+'</a>'+'<a href="javascript://" class="bmc-notice-delete-btn"'+'data-notice-pkid="'+val.pkid+'" data-toggle="tooltip" data-placement="top" title="Удалить">'+'<i class="fa fa-times"></i>'+'</a>'+'</div>'+'<div class="bmc-noticeItem-userName">'+'<div>'+val.title+'</div>'+'</div>'+'<div class="bmc-noticeItem-text">'+val.message+'</div>'+'<div class="bmc-noticeItem-time">'+'<div>'+noticeDateofStr+' ('+dateFormat(val.dateShow,'dd.mm.yyyy HH:MM:ss')+')</div>'+'</div>'+'</div>'+'</div>';cnt1++;}});$('.bmc-main-menu .bmc-readed-notices .bmc-noticesList').append(cont).find('[data-toggle=tooltip]').tooltip();}else{}
var cnt2=$('.bmc-main-menu .bmc-readed-notices .bmc-noticesList .bmc-notice-item').length;if(cnt2==0){$('.bmc-main-menu .bmc-readed-notices .bmc-notices-notfound-block').css('display','block');}else{$('.bmc-main-menu .bmc-readed-notices .bmc-notices-notfound-block').css('display','none');}
$('.bmc-main-menu .bmc-readed-notices .bmc-get-moreReaded-notices').html('Еще');$searchReadedNoticesBtn.find('i').removeClass('fa-spinner');if(searchword2!=''){$searchReadedNoticesBtn.find('i').addClass('fa-reorder');}else{$searchReadedNoticesBtn.find('i').addClass('fa-search');}}});}
function getNoticesIncoming(){ioCallEntity({entity:'com.notice.model.notices.getUnreadedCount',resultType:'json',params:{},success:function(data){var obj;try{obj=$.parseJSON(data);}catch(ex){obj=null;}
if(obj!=null&&typeof(obj.res)!='undefined'&&obj.res!=null&&obj.res.error_code=='1'){var noticesCount=obj.res.count;if(noticesCount){if($navbarElem.is(':hidden')){$toggleMnuBtn.addClass('bmc-new-notices');}else{$toggleMnuBtn.removeClass('bmc-new-notices');}}
Tinycon.setOptions({width:7,height:9,font:'10px Arial',color:'#fff',background:'#ff6161',fallback:true,});Tinycon.setBubble(noticesCount>9?'9+':noticesCount);if(noticesCount){$('.bmc-main-menu .bmc-options-list .bmc-notices-count').addClass('animated infinite fadeIn').html(noticesCount);}else{$('.bmc-main-menu .bmc-options-list .bmc-notices-count').removeClass('animated infinite fadeIn').html('');}}else{$('.bmc-main-menu .bmc-options-list .bmc-notices-count').removeClass('animated infinite fadeIn').html('');}}});setTimeout(function(){getNoticesIncoming();},60000);}
function hideAllNoticeBlocks(){$allNoticeBlocks.css('display','none');$('.bmc-main-menu .bmc-site-notices .bmc-notices-notfound-block').css('display','none');$searchReadedNotices.css('display','none').find('input').val();$searchUnreadedNotices.css('display','none').find('input').val();$searchReadedNoticesBtn.find('i').removeClass('fa-spinner fa-reorder').addClass('fa-search');$searchUnreadedNoticesBtn.find('i').removeClass('fa-spinner fa-reorder').addClass('fa-search');}